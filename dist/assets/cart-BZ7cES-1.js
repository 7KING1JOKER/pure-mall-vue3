const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BRCmbdoR.js","assets/vue-vendor-CX6JgQha.js","assets/axios-DZIQhO2a.js","assets/element-plus-ChN3TaTZ.js","assets/utils-DcEdpf46.js","assets/index-Dw_V98DU.css"])))=>i.map(i=>d[i]);
import{u as e,r as t,_ as r,b as a}from"./index-BRCmbdoR.js";import{ay as s}from"./vue-vendor-CX6JgQha.js";import{a as c,E as i}from"./element-plus-ChN3TaTZ.js";import"./axios-DZIQhO2a.js";import"./utils-DcEdpf46.js";const d=e(),o=s("cart",{state:()=>({cartItems:[],activeStep:0}),getters:{selectedCount:e=>(Array.isArray(e.cartItems)?e.cartItems:[]).filter(e=>e?.selected).length,totalQuantity:e=>(Array.isArray(e.cartItems)?e.cartItems:[]).filter(e=>e?.selected).reduce((e,t)=>e+(t?.quantity||0),0),totalAmount:e=>(Array.isArray(e.cartItems)?e.cartItems:[]).filter(e=>e?.selected).reduce((e,t)=>e+(t?.price||0)*(t?.quantity||0),0),selectAll:e=>{const t=Array.isArray(e.cartItems)?e.cartItems:[];return t.length>0&&t.every(e=>e?.selected)}},actions:{setActiveStep(e){this.activeStep=e},setSelected(e){try{this.toggleSelectCartItem(d.userId,e)}catch(t){return void c({title:"更新失败",message:"更新购物车商品选中状态失败，请稍后重试",type:"error",duration:2e3})}},setSelectAll(e){try{this.toggleSelectAll(d.userId,e)}catch(t){return void c({title:"更新失败",message:"更新购物车商品选中状态失败，请稍后重试",type:"error",duration:2e3})}this.cartItems.forEach(t=>{t.selected=e})},updateQuantity(e,t){try{this.updateCartItemQuantity(d.userId,e,t)}catch(r){return void c({title:"更新失败",message:"更新购物车商品数量失败，请稍后重试",type:"error",duration:2e3})}},removeCartItem(e){try{this.deleteCartItem(d.username,e)}catch(t){return void c({title:"删除失败",message:"删除购物车商品失败，请稍后重试",type:"error",duration:2e3})}this.cartItems.find(t=>t.id===e)&&(this.cartItems=this.cartItems.filter(t=>t.id!==e))},removeSelected(){try{this.deleteSelectedItems(d.userId)}catch(e){return void c({title:"删除失败",message:"删除选中购物车商品失败，请稍后重试",type:"error",duration:2e3})}this.cartItems=this.cartItems.filter(e=>!e.selected)},clearCart(){try{this.clearCartItems(d.username)}catch(e){return void c({title:"清空失败",message:"清空购物车失败，请稍后重试",type:"error",duration:2e3})}this.cartItems=[],c({title:"清空成功",message:"购物车已清空",type:"success",duration:2e3})},addToCart(e){try{this.addCartItems(d.username,e)}catch(r){return void c({title:"添加失败",message:"添加购物车商品失败，请稍后重试",type:"error",duration:2e3})}const t=this.cartItems.find(t=>t.productId===e.productId&&t.spec===e.spec);if(t)t.quantity+=1;else{const t=Date.now()+Math.floor(1e3*Math.random());this.cartItems.push({id:t,productId:e.productId,userId:e.userId,name:e.name,description:e.description,price:e.price,quantity:1,selected:!0,spec:e.spec,imageUrl:e.imageUrl})}i.success({message:`已添加 "${e.name}" 到购物车`,duration:2e3})},goShopping(){a.push("/category")},async checkout(){if(0===this.selectedCount)return void i.error("请至少选择一件商品进行结算");const{useOrderStore:e}=await r(async()=>{const{useOrderStore:e}=await import("./index-BRCmbdoR.js").then(e=>e.o);return{useOrderStore:e}},__vite__mapDeps([0,1,2,3,4,5])),t=e(),s=this.cartItems.filter(e=>e.selected);t.selectedItemsForCheckout=s.map(e=>({name:e.name,spec:e.spec,price:e.price,quantity:e.quantity,imageUrl:e.imageUrl})),this.removeSelected(),a.push("/checkout")},async loadCartItems(e){try{const r=await t.get("/cart/getCartItems",{},{params:{username:e}});200===r.code&&(this.cartItems=r.data.cartItems||[])}catch(r){c({title:"加载购物车失败",message:"请稍后重试",type:"error",duration:2e3})}},async addCartItems(e,r){try{(await t.post("/cart/addCartItems",r,{params:{username:e}})).code}catch(a){c({title:"更新购物车失败",message:"请稍后重试",type:"error",duration:2e3})}},async deleteCartItem(e,r){try{200===(await t.del("/cart/deleteCartItem",{},{params:{username:e,Id:r}})).code&&c({title:"购物车更新成功",message:"您的购物车商品已更新",type:"success",duration:2e3})}catch(a){c({title:"删除购物车失败",message:"请稍后重试",type:"error",duration:2e3})}},async deleteSelectedItems(e){try{(await t.del("/cart/deleteSelectedCartItems",{},{params:{userId:e}})).code}catch(r){c({title:"删除购物车失败",message:"请稍后重试",type:"error",duration:2e3})}},async clearCartItems(e){try{(await t.del("/cart/clearCartItems",{},{params:{username:e}})).code}catch(r){c({title:"删除购物车失败",message:"请稍后重试",type:"error",duration:2e3})}},async toggleSelectAll(e,r){try{(await t.put("/cart/selectedAll",{},{params:{userId:e,selected:r}})).code}catch(a){c({title:"操作失败",message:"请稍后重试",type:"error",duration:2e3})}},async toggleSelectCartItem(e,r){try{(await t.put("/cart/selectedCartItem",{},{params:{userId:e,cartItemId:r}})).code}catch(a){c({title:"操作失败",message:"请稍后重试",type:"error",duration:2e3})}},async updateCartItemQuantity(e,r,a){try{(await t.put("/cart/updateCartItemQuantity",{},{params:{userId:e,cartItemId:r,quantity:a}})).code}catch(s){c({title:"操作失败",message:"请稍后重试",type:"error",duration:2e3})}}}});export{o as useCartStore};
